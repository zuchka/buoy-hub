export interface BuoyMetadata {
  id: string;
  name: string;
  lat: number;
  lng: number;
}

// Known coordinates for major buoys (these will be displayed properly on the map)
// Other buoys will have 0,0 coordinates until their data is fetched
const KNOWN_BUOY_COORDINATES: Record<
  string,
  { lat: number; lng: number; name?: string }
> = {
  // Pacific Hawaii region (51000 series)
  "51004": { lat: 17.48, lng: -152.5, name: "Hanauma Bay Buoy 51004" },
  "51001": { lat: 23.445, lng: -162.279, name: "Northwest Hawaii Buoy 51001" },
  "51002": { lat: 17.2, lng: -157.75, name: "South Papa Buoy 51002" },
  "51000": { lat: 23.55, lng: -153.87, name: "Papa Hawaii Buoy 51000" },
  "51101": { lat: 24.33, lng: -162.12, name: "HURL Mooring Buoy 51101" },

  // Pacific West Coast (46000 series)
  "46001": { lat: 56.3, lng: -148.02, name: "Gulf of Alaska Buoy 46001" },
  // "46002": REMOVED - buoy was adrift and recovered in 2023, not currently reporting data
  "46002": { lat: 42.612, lng: -130.515, name: "Oregon Buoy 46002 (INACTIVE)" },
  "46011": { lat: 34.455, lng: -120.986, name: "Santa Barbara Buoy 46011" },
  "46013": { lat: 38.242, lng: -123.301, name: "Bodega Bay Buoy 46013" },
  "46014": { lat: 39.23, lng: -123.964, name: "Point Arena Buoy 46014" },
  "46015": { lat: 40.294, lng: -124.731, name: "Cape Mendocino Buoy 46015" },
  "46022": { lat: 40.71, lng: -124.53, name: "Eel River Buoy 46022" },
  "46025": { lat: 33.75, lng: -119.0, name: "Santa Monica Basin Buoy 46025" },
  "46026": { lat: 37.759, lng: -122.833, name: "San Francisco Buoy 46026" },
  "46027": { lat: 41.85, lng: -124.38, name: "St. Georges Buoy 46027" },
  "46028": { lat: 35.74, lng: -121.884, name: "Cape San Martin Buoy 46028" },
  "46029": { lat: 46.144, lng: -124.519, name: "Columbia River Buoy 46029" },
  "46035": { lat: 40.96, lng: -124.73, name: "Humboldt Bay Buoy 46035" },
  "46041": { lat: 47.35, lng: -124.73, name: "Cape Elizabeth Buoy 46041" },
  "46047": { lat: 32.43, lng: -119.54, name: "Tanner Banks Buoy 46047" },
  "46050": { lat: 44.64, lng: -124.5, name: "Stonewall Bank Buoy 46050" },

  // Atlantic Ocean buoys (41000 series)
  "41001": { lat: 34.502, lng: -72.522, name: "East Hatteras Buoy 41001" },
  "41002": { lat: 31.743, lng: -74.955, name: "South Hatteras Buoy 41002" },
  "41004": { lat: 32.501, lng: -79.099, name: "Edisto Buoy 41004" },
  "41008": { lat: 31.402, lng: -80.868, name: "Gray's Reef Buoy 41008" },
  "41009": { lat: 28.519, lng: -80.166, name: "Canaveral East Buoy 41009" },
  "41010": { lat: 28.878, lng: -78.485, name: "Canaveral Buoy 41010" },
  "41013": { lat: 33.436, lng: -77.765, name: "Frying Pan Shoals Buoy 41013" },
  "41024": { lat: 33.84, lng: -78.48, name: "Cape Fear Buoy 41024" },
  "41025": { lat: 35.006, lng: -75.402, name: "Diamond Shoals Buoy 41025" },
  "41029": { lat: 32.81, lng: -79.63, name: "Savannah Buoy 41029" },
  "41033": { lat: 32.28, lng: -80.42, name: "Savannah Offshore Buoy 41033" },

  // Gulf of Mexico buoys (42000 series)
  "42001": { lat: 25.888, lng: -89.658, name: "Mid Gulf Buoy 42001" },
  "42002": { lat: 26.058, lng: -93.64, name: "West Gulf Buoy 42002" },
  "42012": { lat: 30.06, lng: -87.55, name: "Orange Beach Buoy 42012" },
  "42013": { lat: 27.17, lng: -82.93, name: "Dry Tortugas Buoy 42013" },
  "42019": { lat: 27.907, lng: -95.352, name: "Freeport Buoy 42019" },
  "42020": { lat: 26.968, lng: -96.695, name: "Corpus Christi Buoy 42020" },
  "42035": { lat: 29.23, lng: -94.41, name: "Galveston Buoy 42035" },
  "42036": { lat: 28.5, lng: -84.52, name: "West Tampa Buoy 42036" },
  "42040": { lat: 29.21, lng: -88.23, name: "Luke Offshore Buoy 42040" },

  // Northeast buoys (44000 series)
  "44007": { lat: 43.53, lng: -67.3, name: "Portland Buoy 44007" },
  "44008": { lat: 40.5, lng: -69.25, name: "Nantucket Buoy 44008" },
  "44009": { lat: 38.46, lng: -74.7, name: "Delaware Bay Buoy 44009" },
  "44011": { lat: 41.1, lng: -66.58, name: "Georges Bank Buoy 44011" },
  "44013": { lat: 42.346, lng: -70.651, name: "Boston Buoy 44013" },
  "44014": { lat: 36.611, lng: -74.84, name: "Virginia Beach Buoy 44014" },
  "44020": { lat: 41.44, lng: -70.28, name: "Nantucket Sound Buoy 44020" },
  "44025": { lat: 40.251, lng: -73.164, name: "Long Island Buoy 44025" },
  "44027": { lat: 44.28, lng: -67.308, name: "Jonesport Buoy 44027" },
  "44065": { lat: 40.369, lng: -73.703, name: "New York Harbor Buoy 44065" },

  // PIRATA array stations
  "13001": { lat: 12.0, lng: -23.0, name: "PIRATA Atlantic Buoy 13001" },
  "13002": { lat: 21.0, lng: -23.0, name: "PIRATA Atlantic Buoy 13002" },
  "13008": { lat: 15.0, lng: -38.0, name: "PIRATA Atlantic Buoy 13008" },
  "23001": { lat: 0.0, lng: 81.0, name: "PIRATA Indian Ocean Buoy 23001" },
  "23003": { lat: -2.0, lng: 81.0, name: "PIRATA Indian Ocean Buoy 23003" },
  "23007": { lat: 8.0, lng: 81.0, name: "PIRATA Indian Ocean Buoy 23007" },
  "23008": { lat: 12.0, lng: 81.0, name: "PIRATA Indian Ocean Buoy 23008" },
  "23009": { lat: 15.0, lng: 81.0, name: "PIRATA Indian Ocean Buoy 23009" },
  "23010": { lat: 8.0, lng: 90.0, name: "PIRATA Indian Ocean Buoy 23010" },
  "23012": { lat: 12.0, lng: 90.0, name: "PIRATA Indian Ocean Buoy 23012" },
  "23013": { lat: 15.0, lng: 90.0, name: "PIRATA Indian Ocean Buoy 23013" },
  "23014": { lat: 4.0, lng: 81.0, name: "PIRATA Indian Ocean Buoy 23014" },
  "23016": { lat: 4.0, lng: 90.0, name: "PIRATA Indian Ocean Buoy 23016" },
  "23019": { lat: 0.0, lng: 90.0, name: "PIRATA Indian Ocean Buoy 23019" },

  // Great Lakes buoys
  "14048": { lat: 45.88, lng: -84.91, name: "Great Lakes Buoy 14048" },
  "14049": { lat: 46.5, lng: -84.25, name: "Great Lakes Buoy 14049" },
  "15001": { lat: 42.67, lng: -87.0, name: "Great Lakes Buoy 15001" },
  "15002": { lat: 45.34, lng: -86.41, name: "Great Lakes Buoy 15002" },
  "15006": { lat: 43.63, lng: -77.4, name: "Great Lakes Buoy 15006" },
  "15009": { lat: 44.28, lng: -83.43, name: "Great Lakes Buoy 15009" },

  // Major C-MAN stations with known coordinates
  WAHV2: { lat: 37.608, lng: -75.686, name: "Wachapreague, VA" },
  WAKP8: { lat: 21.95, lng: -159.35, name: "Keehole Point, HI" },
  WASD2: { lat: 38.88, lng: -75.07, name: "Assateague, DE" },
  WCRP1: { lat: 40.25, lng: -74.06, name: "Cape Race, NJ" },
  WCXA2: { lat: 70.2, lng: -148.52, name: "Cross Island, AK" },
  WDSV2: { lat: 36.83, lng: -76.01, name: "Dominion Station, VA" },
  WFPM4: { lat: 45.32, lng: -84.72, name: "Fourteen Foot Bank, MI" },
  WGXA2: { lat: 59.46, lng: -139.86, name: "Glacier Bay, AK" },
  WHRI2: { lat: 42.6, lng: -87.08, name: "Hart-Miller Island, IL" },
  WIWF1: { lat: 25.61, lng: -80.16, name: "Indian Key, FL" },
  WIXA2: { lat: 55.32, lng: -131.58, name: "Wrangell, AK" },
  WKXA1: { lat: 30.38, lng: -87.75, name: "Mobile Bay, AL" },
  WLON7: { lat: 34.22, lng: -77.96, name: "Long Bay, NC" },
  WNEM4: { lat: 42.67, lng: -82.48, name: "New Baltimore, MI" },
  WPLF1: { lat: 30.07, lng: -85.65, name: "Panama City, FL" },
  WPOW1: { lat: 48.33, lng: -124.73, name: "La Push, WA" },
  WPTW1: { lat: 47.37, lng: -124.73, name: "Westport, WA" },
  WRBF1: { lat: 25.0, lng: -80.38, name: "Robbie, FL" },
  WRXA2: { lat: 60.78, lng: -161.84, name: "Red Dog Dock, AK" },
  WWEF1: { lat: 24.63, lng: -82.92, name: "Everglades, FL" },
  WYCM6: { lat: 29.72, lng: -93.87, name: "Cameron, LA" },
  YATA2: { lat: 70.73, lng: -156.77, name: "Prudhoe Bay, AK" },
  YGNN6: { lat: 43.26, lng: -79.06, name: "Youngstown, NY" },
  YKTV2: { lat: 37.21, lng: -76.5, name: "Yorktown, VA" },
  YRSV2: { lat: 37.23, lng: -76.48, name: "York River, VA" },

  // Additional station codes
  "32ST0": { lat: 32.0, lng: -80.0, name: "Atlantic Station 32ST0" },
  "51WH0": { lat: 51.0, lng: -4.0, name: "Weather Station 51WH0" },
};

// Cache for the fetched buoy list
let cachedBuoyList: BuoyMetadata[] | null = null;
let lastFetchTime: number | null = null;
const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours

// Default buoy to display on initial load
export const DEFAULT_BUOY_ID = "13001";

// Complete verified active buoys list based on actual NOAA directory listing
// These buoys have confirmed .txt data files available in the NOAA realtime2 directory
// List extracted from actual NOAA server directory listing - 614 total stations
const VERIFIED_ACTIVE_BUOYS = [
  "13001",
  "13002",
  "13008",
  "14048",
  "14049",
  "15001",
  "15002",
  "15006",
  "15009",
  "23001",
  "23003",
  "23007",
  "23008",
  "23009",
  "23010",
  "23012",
  "23013",
  "23014",
  "23016",
  "23019",
  "31003",
  "31004",
  "31006",
  "32ST0",
  "41001",
  "41002",
  "41004",
  "41008",
  "41009",
  "41010",
  "41013",
  "41024",
  "41025",
  "41029",
  "41033",
  "41037",
  "41038",
  "41040",
  "41043",
  "41044",
  "41046",
  "41047",
  "41049",
  "41052",
  "41053",
  "41056",
  "41064",
  "41065",
  "41066",
  "41067",
  "41068",
  "41069",
  "41070",
  "41076",
  "41082",
  "41083",
  "41108",
  "41110",
  "41112",
  "41113",
  "41114",
  "41115",
  "41117",
  "41120",
  "41122",
  "41159",
  "42001",
  "42002",
  "42012",
  "42013",
  "42019",
  "42020",
  "42022",
  "42023",
  "42026",
  "42035",
  "42036",
  "42040",
  "42055",
  "42056",
  "42057",
  "42058",
  "42059",
  "42060",
  "42067",
  "42084",
  "42085",
  "42091",
  "42092",
  "42095",
  "42097",
  "42098",
  "42099",
  "42354",
  "44007",
  "44008",
  "44009",
  "44011",
  "44013",
  "44014",
  "44020",
  "44025",
  "44027",
  "44029",
  "44030",
  "44032",
  "44033",
  "44034",
  "44042",
  "44056",
  "44058",
  "44062",
  "44063",
  "44065",
  "44072",
  "44073",
  "44078",
  "44079",
  "44080",
  "44084",
  "44085",
  "44086",
  "44088",
  "44089",
  "44090",
  "44091",
  "44095",
  "44097",
  "44098",
  "44099",
  "44100",
  "44137",
  "44139",
  "44150",
  "44258",
  "44488",
  "44489",
  "45001",
  "45002",
  "45003",
  "45004",
  "45005",
  "45006",
  "45007",
  "45008",
  "45012",
  "45013",
  "45014",
  "45022",
  "45023",
  "45025",
  "45026",
  "45027",
  "45028",
  "45029",
  "45135",
  "45136",
  "45137",
  "45139",
  "45140",
  "45143",
  "45144",
  "45145",
  "45147",
  "45148",
  "45149",
  "45151",
  "45152",
  "45154",
  "45159",
  "45161",
  "45164",
  "45168",
  "45174",
  "45175",
  "45176",
  "45194",
  "45196",
  "45197",
  "45198",
  "45199",
  "45200",
  "45201",
  "45202",
  "45203",
  "45204",
  "45205",
  "45206",
  "45207",
  "45208",
  "45209",
  "45210",
  "45211",
  "45212",
  "45213",
  "45214",
  "45215",
  "45216",
  "45219",
  "46001",
  "46011",
  "46013",
  "46014",
  "46015",
  "46022",
  "46025",
  "46026",
  "46027",
  "46028",
  "46029",
  "46035",
  "46041",
  "46047",
  "46050",
  "46053",
  "46054",
  "46059",
  "46060",
  "46069",
  "46071",
  "46072",
  "46073",
  "46076",
  "46077",
  "46078",
  "46080",
  "46081",
  "46083",
  "46084",
  "46085",
  "46086",
  "46087",
  "46088",
  "46089",
  "46092",
  "46097",
  "46098",
  "46099",
  "46100",
  "46108",
  "46120",
  "46122",
  "46123",
  "46131",
  "46132",
  "46145",
  "46146",
  "46147",
  "46181",
  "46183",
  "46185",
  "46204",
  "46205",
  "46206",
  "46207",
  "46208",
  "46211",
  "46213",
  "46214",
  "46215",
  "46218",
  "46219",
  "46221",
  "46222",
  "46224",
  "46225",
  "46229",
  "46232",
  "46235",
  "46236",
  "46237",
  "46239",
  "46240",
  "46243",
  "46244",
  "46246",
  "46248",
  "46251",
  "46253",
  "46254",
  "46256",
  "46258",
  "46259",
  "46266",
  "46267",
  "46268",
  "46274",
  "46275",
  "46276",
  "46277",
  "46278",
  "46279",
  "46280",
  "46281",
  "46283",
  "46284",
  "46304",
  "48400",
  "51000",
  "51001",
  "51002",
  "51004",
  "51101",
  "51201",
  "51202",
  "51205",
  "51206",
  "51207",
  "51208",
  "51209",
  "51210",
  "51211",
  "51212",
  "51213",
  "51214",
  "51WH0",
  "52200",
  "52201",
  "52202",
  "52211",
  "52212",
  "52213",
  "52215",
  "53005",
  "62029",
  "62050",
  "62081",
  "62103",
  "62105",
  "62107",
  "62114",
  "62121",
  "62124",
  "62127",
  "62130",
  "62144",
  "62145",
  "62146",
  "62148",
  "62149",
  "62163",
  "62164",
  "62165",
  "62170",
  "62304",
  "62305",
  "63110",
  "63112",
  "63115",
  "64045",
  "AAMC1",
  "ABYA2",
  "ACXS1",
  "ACYN4",
  "ADKA2",
  "AGCM4",
  "AGXC1",
  "AJXA2",
  "AKXA2",
  "ALIA2",
  "ALXN6",
  "AMAA2",
  "AMRL1",
  "ANMN6",
  "ANPT2",
  "ANTA2",
  "ANVC1",
  "APAM2",
  "APCF1",
  "APMA2",
  "APNM4",
  "APRP7",
  "APXA2",
  "APXF1",
  "ARPF1",
  "ASBO1",
  "ATGM1",
  "ATKA2",
  "AUGA2",
  "AWRT2",
  "BABT2",
  "BATN6",
  "BAXC1",
  "BBNF1",
  "BBSF1",
  "BDRN4",
  "BDSP1",
  "BDVF1",
  "BDXC1",
  "BEXA2",
  "BFTN7",
  "BGXN3",
  "BHBM3",
  "BHRI3",
  "BIGM4",
  "BISM2",
  "BKBF1",
  "BKTL1",
  "BKYF1",
  "BLIA2",
  "BLIF1",
  "BLTM2",
  "BLTM3",
  "BMTW1",
  "BNKF1",
  "BOBF1",
  "BRHC3",
  "BRND1",
  "BSBM4",
  "BSCA1",
  "BSKF1",
  "BSLM2",
  "BUFN6",
  "BURL1",
  "BUZM3",
  "BWSF1",
  "BYGL1",
  "BZBM3",
  "BZST2",
  "CAMM2",
  "CANF1",
  "CAPL1",
  "CARL1",
  "CASM1",
  "CAVN6",
  "CBLO1",
  "CBRW3",
  "CDEA2",
  "CDXA2",
  "CECC1",
  "CFWM1",
  "CHAO3",
  "CHAV3",
  "CHBV2",
  "CHCM2",
  "CHII2",
  "CHSV3",
  "CHTM3",
  "CHTS1",
  "CHYV2",
  "CHYW1",
  "CKYF1",
  "CLBP4",
  "CLKN7",
  "CLSM4",
  "CMAN4",
  "CMLN3",
  "CMPO1",
  "CMTI2",
  "CNBF1",
  "CNDO1",
  "CNII2",
  "COVM2",
  "COXA2",
  "CPMW1",
  "CPNW1",
  "CPSA2",
  "CPTR1",
  "CPVM2",
  "CPXA2",
  "CPXC1",
  "CRGA2",
  "CRTA1",
  "CRVA2",
  "CRYV2",
  "CSPA2",
  "CSXA2",
  "CWAF1",
  "CWBF1",
  "CWCI",
  "CXLM2",
  "CYGM4",
  "DBLN6",
  "DELD1",
  "DESW1",
  "DHXA2",
  "DILA1",
  "DISW3",
  "DKKF1",
  "DMSF1",
  "DOMV2",
  "DPHA1",
  "DPLA2",
  "DPOA2",
  "DPXA2",
  "DPXC1",
  "DRSD1",
  "DTLM4",
  "DUKN7",
  "DULM5",
  "EBEF1",
  "EFLA1",
  "EINL1",
  "ELFA2",
  "ELXC1",
  "EMAT2",
  "EPTT2",
  "EROA2",
  "ERXA2",
  "ESPP4",
  "FAIO1",
  "FFIA2",
  "FILA2",
  "FMRF1",
  "FOXR1",
  "FPKG1",
  "FPST2",
  "FPTM4",
  "FRCB6",
  "FRDF1",
  "FRDW1",
  "FRMA1",
  "FRVM3",
  "FRWL1",
  "FRXM3",
  "FSKM2",
  "FTGM4",
  "FTPC1",
  "GBIF1",
  "GBTF1",
  "GBWW3",
  "GBXA2",
  "GDMM5",
  "GDXM6",
  "GELO1",
  "GEXA2",
  "GISL1",
  "GIXA2",
  "GNJT2",
  "GPXA2",
  "GRMM4",
  "GRRT2",
  "GSLM4",
  "GTLM4",
  "GTOT2",
  "GTXF1",
  "GUXA2",
  "HAXA2",
  "HBXC1",
  "HBYC1",
  "HCEF1",
  "HCGN7",
  "HHLO1",
  "HIST2",
  "HIVT2",
  "HLNM4",
  "HMRA2",
  "HMSA2",
  "HRBM4",
  "HREF1",
  "HRRH1",
  "ICAC1",
  "ICYA2",
  "ILOH1",
  "IOSN3",
  "IRDT2",
  "ITKA2",
  "JBYF1",
  "JCRN4",
  "JKYF1",
  "JLXA2",
  "JMLA2",
  "JMPN7",
  "JNEA2",
  "JNGA2",
  "JOXP4",
  "JXUF1",
  "KATP",
  "KBMG1",
  "KBQX",
  "KECA2",
  "KEXA2",
  "KGBK",
  "KGCA2",
  "KGHB",
  "KGNA",
  "KGUL",
  "KGVW",
  "KGXA2",
  "KHHV",
  "KIKT",
  "KLIH1",
  "KLMW1",
  "KMXA2",
  "KNXA2",
  "KP53",
  "KP58",
  "KP59",
  "KPTN6",
  "KPTV2",
  "KVAF",
  "KVOA",
  "KWHH1",
  "KWJP8",
  "KWNW3",
  "KYWF1",
  "LAMV3",
  "LAPW1",
  "LBSF1",
  "LCLL1",
  "LCNA2",
  "LDTM4",
  "LIXA2",
  "LJAC1",
  "LJPC1",
  "LKWF1",
  "LMDF1",
  "LMFS1",
  "LMRF1",
  "LNDC1",
  "LONF1",
  "LOPL1",
  "LOPW1",
  "LORO1",
  "LPNM4",
  "LQAT2",
  "LRIF1",
  "LRKF1",
  "LSNF1",
  "LTBV3",
  "LTJF1",
  "LTRM4",
  "LUIT2",
  "LWSD1",
  "LWTV2",
  "MACM4",
  "MBET2",
  "MBIN7",
  "MBNN7",
  "MBPA1",
  "MBRM4",
  "MBXC1",
  "MCGA1",
  "MCGM4",
  "MCYI3",
  "MDKF1",
  "MDRM1",
  "MDXA2",
  "MEEM4",
  "MEYC1",
  "MGIP4",
  "MGPT2",
  "MGZP4",
  "MHBT2",
  "MHRN6",
  "MISM1",
  "MISP4",
  "MIST2",
  "MIXA2",
  "MKGM4",
  "MLSC1",
  "MLWW3",
  "MNBF1",
  "MNMM4",
  "MNPV2",
  "MOKH1",
  "MRCP1",
  "MRHO1",
  "MRKA2",
  "MRNA2",
  "MROS1",
  "MRYA2",
  "MTBF1",
  "MTKN6",
  "MUKF1",
  "MVXA2",
  "MXXA2",
  "MYPF1",
  "MZXC1",
  "NABM4",
  "NAXR1",
  "NBGM3",
  "NBLP1",
  "NCDV2",
  "NCHT2",
  "NEAW1",
  "NFDF1",
  "NIAN6",
  "NIWS1",
  "NJLC1",
  "NKLA2",
  "NKTA2",
  "NKXA2",
  "NLHC3",
  "NLXA2",
  "NMTA2",
  "NMXA2",
  "NPDW3",
  "NPXN6",
  "NREP1",
  "NRRF1",
  "NSTP6",
  "NSXA2",
  "NTBC1",
  "NTKM3",
  "NWCL1",
  "NWHC3",
  "NWPO3",
  "NWPR1",
  "NWWH1",
  "OBGN6",
  "OBLA1",
  "OBXC1",
  "OCIM2",
  "OKSI2",
  "OKXC1",
  "OLCN6",
  "OLSA2",
  "OMHC1",
  "OOUH1",
  "OPTF1",
  "ORIN7",
  "OSGN6",
  "OSTF1",
  "OTNM4",
  "OVIA2",
  "OWMO1",
  "OWXO1",
  "PACF1",
  "PACT2",
  "PAUA2",
  "PAXA2",
  "PBFW1",
  "PBPA2",
  "PCBF1",
  "PCGT2",
  "PCLF1",
  "PCLM4",
  "PCNT2",
  "PCOC1",
  "PCXA2",
  "PDVR1",
  "PEGF1",
  "PEXA2",
  "PFDC1",
  "PFXC1",
  "PGBP7",
  "PGXA2",
  "PHBP1",
  "PILA2",
  "PILL1",
  "PILM4",
  "PKBW3",
  "PKYF1",
  "PLXA2",
  "PMAF1",
  "PMNT2",
  "PNGW3",
  "PNLM4",
  "PNLM6",
  "PORO3",
  "PORT2",
  "POTA2",
  "PPTM2",
  "PPXA2",
  "PPXC1",
  "PRDA2",
  "PRHH1",
  "PRIM4",
  "PRJC1",
  "PRTA2",
  "PRYC1",
  "PSBC1",
  "PSBM1",
  "PSLC1",
  "PSTL1",
  "PSTN6",
  "PSXC1",
  "PTAT2",
  "PTAW1",
  "PTBM6",
  "PTCR1",
  "PTFL1",
  "PTIM4",
  "PTIT2",
  "PTLA2",
  "PTOA1",
  "PTWW1",
  "PVDR1",
  "PXAC1",
  "PXOC1",
  "PXSC1",
  "QPTR1",
  "RCKM4",
  "RCMC1",
  "RCPT2",
  "RCRN6",
  "RDDA2",
  "RDYD1",
  "RIXA2",
  "RKXF1",
  "RLIT2",
  "RLOT2",
  "ROAM4",
  "ROBN4",
  "RPLV2",
  "RPRN6",
  "RSJT2",
  "RTAT2",
  "RTYC1",
  "SANF1",
  "SAPF1",
  "SAUF1",
  "SAXG1",
  "SBEO3",
  "SBIO1",
  "SBLM4",
  "SCXA2",
  "SDBC1",
  "SDHN4",
  "SDIA2",
  "SDRT2",
  "SEIM1",
  "SFXC1",
  "SGNW3",
  "SGXA2",
  "SHBL1",
  "SHXA2",
  "SIPF1",
  "SISA2",
  "SISW1",
  "SJNP4",
  "SJSN4",
  "SKCF1",
  "SKTA2",
  "SKXA2",
  "SLIM2",
  "SLVM5",
  "SLXA2",
  "SNDA2",
  "SNDP5",
  "SNTO3",
  "SPGF1",
  "SPTM4",
  "SREF1",
  "SRLM4",
  "SRXA2",
  "SSBN7",
  "STXA2",
  "SVNM4",
  "SWLA2",
  "SWPM4",
  "SWPV2",
  "SWXA2",
  "SXXA2",
  "TAQT2",
  "TAWM4",
  "TBIM4",
  "TBYF1",
  "TCBM2",
  "TCMW1",
  "TCNW1",
  "TCVF1",
  "TDPC1",
  "TESL1",
  "TGXA2",
  "THLO1",
  "THRF1",
  "THRO1",
  "TIBC1",
  "TIXC1",
  "TKEA2",
  "TKPN6",
  "TLVT2",
  "TOKW1",
  "TPEF1",
  "TPLM2",
  "TRDF1",
  "TRRF1",
  "TSHF1",
  "TWCO1",
  "TXPT2",
  "TXVT2",
  "ULRA2",
  "UNLA2",
  "UPBC1",
  "UQXA2",
  "UTVT2",
  "VAKF1",
  "VCAF1",
  "VCAT2",
  "VCVA2",
  "VDXA2",
  "VDZA2",
  "VRMO1",
  "VTBT2",
  "WAHV2",
  "WAKP8",
  "WASD2",
  "WAXM3",
  "WCRP1",
  "WCXA2",
  "WDSV2",
  "WEXM1",
  "WFPM4",
  "WGXA2",
  "WHRI2",
  "WIWF1",
  "WIXA2",
  "WKXA1",
  "WLON7",
  "WNEM4",
  "WPLF1",
  "WPOW1",
  "WPTW1",
  "WRBF1",
  "WRXA2",
  "WWEF1",
  "WYCM6",
  "YATA2",
  "YGNN6",
  "YKTV2",
  "YRSV2",
];

// Get the verified buoy list - only includes buoys with confirmed data availability
export const fetchRealBuoyList = async (): Promise<BuoyMetadata[]> => {
  // Return cached data if still valid
  if (
    cachedBuoyList &&
    lastFetchTime &&
    Date.now() - lastFetchTime < CACHE_DURATION
  ) {
    return cachedBuoyList;
  }

  try {
    console.log("Loading complete verified active station list...");

    // Create metadata for all verified buoys
    const buoyMetadata: BuoyMetadata[] = VERIFIED_ACTIVE_BUOYS.map((id) => {
      const known = KNOWN_BUOY_COORDINATES[id];
      return {
        id,
        name: known?.name || `NOAA Station ${id}`,
        lat: known?.lat || 0, // Will be updated when data is fetched
        lng: known?.lng || 0, // Will be updated when data is fetched
      };
    });

    console.log(
      `Loaded ${buoyMetadata.length} verified active stations from NOAA directory:`,
      `${buoyMetadata.filter((b) => b.lat !== 0 && b.lng !== 0).length} with known coordinates`,
    );

    // Cache the result
    cachedBuoyList = buoyMetadata;
    lastFetchTime = Date.now();

    return buoyMetadata;
  } catch (error) {
    console.error("Failed to load verified buoy list, using fallback:", error);

    // Fallback to known buoys with coordinates if something fails
    const fallbackBuoys = Object.entries(KNOWN_BUOY_COORDINATES).map(
      ([id, coord]) => ({
        id,
        name: coord.name || `NOAA Station ${id}`,
        lat: coord.lat,
        lng: coord.lng,
      }),
    );

    return fallbackBuoys;
  }
};

// Initialize with verified active buoy data
export const initializeBuoyMetadata = async (): Promise<BuoyMetadata[]> => {
  try {
    const verifiedBuoys = await fetchRealBuoyList();
    BUOY_METADATA = verifiedBuoys;
    return verifiedBuoys;
  } catch (error) {
    console.error("Failed to initialize buoy metadata:", error);
    return BUOY_METADATA; // Return fallback
  }
};

// Static export for immediate use - using verified active buoys with known coordinates
export let BUOY_METADATA: BuoyMetadata[] = VERIFIED_ACTIVE_BUOYS.map((id) => {
  const known = KNOWN_BUOY_COORDINATES[id];
  return {
    id,
    name: known?.name || `NOAA Station ${id}`,
    lat: known?.lat || 0,
    lng: known?.lng || 0,
  };
});

// Helper function to get buoy metadata by ID
export const getBuoyMetadata = (buoyId: string): BuoyMetadata | undefined => {
  return BUOY_METADATA.find((buoy) => buoy.id === buoyId);
};

// Helper function to get all available buoy IDs
export const getAllBuoyIds = (): string[] => {
  return BUOY_METADATA.map((buoy) => buoy.id);
};

// Helper function to check if a buoy exists in our metadata
export const isBuoySupported = (buoyId: string): boolean => {
  return BUOY_METADATA.some((buoy) => buoy.id === buoyId);
};

// Helper function to update coordinates for a buoy (when data is fetched)
export const updateBuoyCoordinates = (
  buoyId: string,
  lat: number,
  lng: number,
): void => {
  const buoyIndex = BUOY_METADATA.findIndex((buoy) => buoy.id === buoyId);
  if (buoyIndex !== -1) {
    BUOY_METADATA[buoyIndex].lat = lat;
    BUOY_METADATA[buoyIndex].lng = lng;
  }
};

// Helper function to get the verified active buoys list
export const getVerifiedActiveBuoys = (): string[] => {
  return VERIFIED_ACTIVE_BUOYS;
};

// Helper function to check if a buoy is in our verified list
export const isVerifiedActiveBuoy = (buoyId: string): boolean => {
  return VERIFIED_ACTIVE_BUOYS.includes(buoyId);
};

// Helper function to validate verified buoys list
// This can be used to check which buoys in our verified list are actually working
export const validateVerifiedBuoys = () => {
  console.log("🔍 Verified Active Stations List:");
  console.log("Total verified stations:", VERIFIED_ACTIVE_BUOYS.length);
  console.log(
    "Stations with coordinates:",
    VERIFIED_ACTIVE_BUOYS.filter((id) => KNOWN_BUOY_COORDINATES[id]).length,
  );
  console.log(
    "Missing coordinates:",
    VERIFIED_ACTIVE_BUOYS.filter((id) => !KNOWN_BUOY_COORDINATES[id]).length,
  );

  return {
    total: VERIFIED_ACTIVE_BUOYS.length,
    withCoordinates: VERIFIED_ACTIVE_BUOYS.filter(
      (id) => KNOWN_BUOY_COORDINATES[id],
    ),
    missingCoordinates: VERIFIED_ACTIVE_BUOYS.filter(
      (id) => !KNOWN_BUOY_COORDINATES[id],
    ),
  };
};

// Rate-limited coordinate fetching helper for future enhancement
// This can be used to gradually fetch coordinates for stations without them
export const fetchCoordinatesWithRateLimit = async (
  stationIds: string[],
  delayMs: number = 1000,
): Promise<{ [stationId: string]: { lat: number; lng: number } | null }> => {
  const results: { [stationId: string]: { lat: number; lng: number } | null } =
    {};

  console.log(
    `Starting rate-limited coordinate fetch for ${stationIds.length} stations with ${delayMs}ms delay...`,
  );

  for (let i = 0; i < stationIds.length; i++) {
    const stationId = stationIds[i];

    try {
      // In the future, this could call a NOAA API or geocoding service
      // For now, just mark as attempted
      console.log(
        `[${i + 1}/${stationIds.length}] Checking coordinates for station ${stationId}...`,
      );

      // Add rate limiting delay
      if (i > 0) {
        await new Promise((resolve) => setTimeout(resolve, delayMs));
      }

      // Placeholder for actual coordinate fetching logic
      results[stationId] = null;
    } catch (error) {
      console.warn(
        `Failed to fetch coordinates for station ${stationId}:`,
        error,
      );
      results[stationId] = null;
    }
  }

  return results;
};
